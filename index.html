<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<meta https-equiv="Content-Type" content="text/html; charset=utf-8" />
	    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no, initial-scale=1">
		<meta name="screen-orientation" content="portrait"><!-- uc强制竖屏 -->
		<meta name="x5-orientation" content="portrait"><!-- QQ强制竖屏 -->
		<title>双十二抽奖活动</title>
		<style type="text/css">
		 * { padding:0; margin:0;-webkit-tap-highlight-color: rgba(0,0,0,0); box-sizing: border-box;}
		HTML ,body { font-size:12px;height:100%;width:100%; font-family: "Microsoft YaHei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;}
		li { list-style-type:none;}
		input, input[type="button"], input[type="submit"], input[type="reset"] {-webkit-appearance: none; color:slateblue; border:none; outline: none; background:transparent; width: 100%;}
		.wrapper{ width: 100%;min-height: 100%; background-color: #5d00c7;}
		.timer{ margin: 28px  0 0; height: 180px; position: relative;}
		.timer .timer-title{ position: absolute; top: 12px; left: 0; width: 100%; height: 33px; line-height: 35px; font-size: 20px; font-weight: 400; color: #00fcff;}
		.timer .timer-num{ position: absolute; top: 0; left: 53%;}
		.timer .timer-text{ position: absolute; top: 70px; left: 0; width: 100%; text-align: center; }
		.timer .timer-text-order{ font-size: 18px; line-height: 60px; color: #fff; }
		.timer .timer-text-order .order-num{ font-weight: 600; color: #ffea00;}
		.timer .timer-text-more{ font-size: 16px; color: #d4aeff; }
		.draw{ position: relative; height: 340px; margin-top: 22px; }
		.draw .draw-bg{ position: absolute; width: 92%; height: 340px; left: 4%; }
		.draw .twinkle-bg{animation: twinkle 1s infinite;}
		@keyframes twinkle {
		  0% {
		    opacity: 0;
		  }
		  100% {
		    top: 1;
		  }
		}
		.draw .draw-box-btn{ position: relative; top: 50px; left: 33%; z-index: 10;  width: 34%; }
		.draw .draw-box{ margin-bottom: 10px; }
		.draw .draw-prize{ position: absolute; top: 2%; right: 8%; width: 34%; z-index: 10; animation: pop 1s infinite;}
		@keyframes pop {
		  0% {
		    top: 2%;
		  }
		  50% {
		    top: 1.5%;
		  }
		  100% {
		    top: 2.5%;
		  }
		}
		.lucky-list{ position: relative; left: 4%; margin-top: 18px; height: 500px; width: 92%; padding-top: 30px;}
		.lucky-list .lucky-title{ position: absolute; top: 0; left: 20%; width: 60%; z-index: 10; }
		.lucky-list .lucky-bg{ width: 98%; height: 450px; overflow-y: hidden; padding:30px 0 10px; background: #6844eb; border-radius: 10px; text-align: center; font-size: 16px; line-height: 30px; }
		.lucky-list .lucky-bg .list-body{ overflow-y: scroll; height: 380px; }
		.lucky-list .lucky-bg .list-body-no{line-height: 250px; color: #fff;}
		.lucky-list .lucky-bg .list-title .cell{ color: #fff; display: inline-block; }
		.lucky-list .lucky-bg .list-item .cell{ color: #d4aeff; height: 30px; display: inline-block; overflow: hidden; }
		.lucky-list .lucky-bg .name{ width: 25%; }
		.lucky-list .lucky-bg .tel{ width: 35%; }
		.lucky-list .lucky-bg .prize{ width: 36%; }
		
		.mask-wrapper{ position: fixed; top: 0; left: 0;  width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 20; }
		.mask-wrapper .mask-inner{ position: absolute; width: 86%; top: 23%; left: 7%; }
		.mask-wrapper .mask-inner .mask-prize{ position: absolute; top: 20%; width: 100%; text-align: center; font-size: 16px; height:16px; color: yellow; }
		.mask-wrapper .mask-inner .mask-btn{ position: absolute; width: 80%; left: 10%; top: 76%; height: 46px; }
		
		.mask-wrapper .mask-inner .mask-tel-id{ position: absolute; width: 45%; left: 38%; top: 54%; height: 60px; line-height: 28px; }
		.mask-wrapper .mask-inner .mask-btn-login{ position: absolute; top: 77%; left: 10%; width: 80%; }
		.toast{ position: fixed; top: 35%; left: 10%; width: 80%; height: 40px; line-height: 40px; background: rgba(0,0,0,0.5); color: #fff; z-index: 30; text-align: center; border-radius: 10px;font-size: 18px;}
		</style>
		
	
		<script src="https://i3.Yongche.name/s/js/201711/vue.min.js?1478153218"></script>
        <script src="<{asset:js/jquery/jquery-1.8.3.min.js}>"></script>
    		<!--<script type="text/javascript" src="js/jquery-2.0.0.min.js"></script>-->
	</head>
	<body>
		<div id="app">
			<div class="wrapper">
				<div class="head">
					<img src="https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9ijuISw2EAAHOMyBp9-oAAKAoAFgvq8AAc5L865.png" width="100%"/>
				</div>
				
				<div class="timer">
					<div class="timer-text">
						<div class="timer-text-order">当前完成“随叫随到”订单数<span id="order-num" class="order-num" v-html="orderNums"></span>单</div>
						<div class="timer-text-more"> 还差{{orderRemain}}单才能抽奖</div>
					</div>
				</div>
				<div class="draw">
					<div class="draw-bg">
						<img src="https://i3.Yongche.name/media/g2/M01/19/2E/rBEBP1n9inSII26qAADrqxKdIEcAAKAoQCMYtQAAOvD582.png" width="100%" height="100%" />
					</div>
					<div class="draw-bg twinkle-bg">
						<img src="https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9inSISMNKAADijC5dHZEAAKAoAFt5AUAAOKk133.png" width="100%" height="100%" />
					</div>
					<div class="draw-box-btn">
						<div class="draw-box">
							<img src="https://i2.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iK-ISAheAABA8SMeGqcAAKAoADpgQIAAEEJ539.png" width="100%"/>
						</div>
						<div class="draw-btn" @click=getResult>
							<img v-bind:src="drawBtnState" width="100%"/>
						</div>
					</div>
					
				</div>
				<div class="lucky-list">
					<div class="lucky-title">
						<img src="https://i3.Yongche.name/media/g2/M01/19/2E/rBEBJVn9iq6IM1hLAAAVywUdO_IAAKAoQCwXpEAABXj514.png" width="100%"/>
					</div>
					<div class="lucky-bg">
						<div class="list-title">
							<div class="cell name">姓名</div>
							<div class="cell tel">手机号</div>
							<div class="cell prize">奖品</div>
						</div>
						<div class="list-body" v-show="luckyList.length>0">
							<div class="list-item" v-for="item in luckyList">
								<div class="cell name" v-html="item.name"></div>
								<div class="cell tel" v-html="item.cellphone"></div>
								<div class="cell prize" v-html="toPrize(item.award_type)"></div>
							</div>
						</div>
						<div class="list-body-no" v-show="luckyList.length===0">中奖名单将会在这里展现</div>
					</div>
				</div>
			</div>
			<div class="mask-wrapper" v-show="showMask && isLogin">
				<div class="mask-inner">
					<div class="mask-bg">
						<img v-bind:src="showMaskBg" width="100%"/>
					</div>
					<div class="mask-prize" v-html="winPrize"></div>
					<div class="mask-btn" v-show="isLogin" @click=closeMask>
						<img src="https://i3.Yongche.name/media/g2/M03/19/2E/rBEBJVn9jHyIe_znAAArBrpqmz0AAKAngOXaswAACse777.png" width="100%"/>
					</div>
				</div>
			</div>
			<div class="mask-wrapper" v-show="showMask && !isLogin">
				<div class="mask-inner">
					<div class="mask-bg">
						<img v-bind:src="showMaskBg" width="100%"/>
					</div>
					<div class="mask-tel-id">
						<div class="mask-tel">
							<input type="number" name="tel" placeholder="请输入手机号" oninput="if(value.length>11);value=value.slice(0,11)" v-model="telNum" />
						</div>
						<div class="mask-id">
							<input type="number" name="idcard" placeholder="请输入身份证后四位" oninput="if(value.length>4);value=value.slice(0,4)" v-model="idCard" />
						</div>
					</div>
					<div class="mask-btn-login" @click=login>
						<img src="https://i2.Yongche.name/media/g2/M01/19/32/rBEBP1oCYr2ICTCkAAAUf8XeqScAAKB-QP98R8AABSX984.png" width="100%"/>
					</div>
				</div>
			</div>
			<div class="toast" v-show="showToast" v-html="toastMsg"></div>
		</div>
			
<script type="text/javascript">
    function stopBubble(odiv) {
	    if(odiv){
	        odiv.addEventListener("touchstart",function(ev){
	            ev.cancelBubble = true;
	        })
	        odiv.addEventListener("touchmove",function(ev){
	            ev.cancelBubble = true;
	            //ev.preventDefault();
	            return false;
	        })
	        odiv.addEventListener("touchend",function(ev){
	            ev.cancelBubble = true;
	        })
	    }
	}     
new Vue({
  el: '#app',
  data:{
    http:"//yaoyakun.market.Yongche.org",
    //http:"//market.Yongche.com",
	drawBtnTypes:["https://i2.Yongche.name/media/g2/M01/19/2E/rBEBJVn9iq6IQ0XOAAAU6wIkjlcAAKAoQCwDWoAABUD275.png","https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iq2IHZKGAAAU3ilU2-oAAKAoAGAXNwAABT2072.png","https://i3.Yongche.name/media/g2/M04/19/2E/rBEBJVn9iK-IUMaFAAAVy5rudWgAAKAnwKiOWsAABXj236.png"],
  
 	maskBgs:["https://i3.Yongche.name/media/g2/M03/19/32/rBEBJVoCYMyIELiVAAN5o9ioJSMAAKB-wG2NrcAA3m7481.png","https://i2.Yongche.name/media/g2/M03/19/2E/rBEBP1n9jHyIGo_YAARTK_MEi3gAAKAngOg7PoABFND414.png"],
  	isLogin:0,
  	isClick:0,
	orderNums:0,
	orderRemain:12,
	drawBtn:false,
	luckyList:[],
	showMask:false,
	maskType:0,
	winPrize:"",
	showToast:false,
	toastMsg:"",
	telNum:null,
  	idCard:null,
	driver_id:0
  },
  computed:{
  	drawBtnState:function(){
  		var idx = this.isClick+1;
  		return this.drawBtnTypes[idx];
  	},
  	showMaskBg:function(){
  		var idx = this.isLogin==0 ? 0 : this.maskType;
		return this.maskBgs[idx];
  	}
  },
  mounted: function(){
	this.initData();
	setTimeout(function(){
		stopBubble(document.getElementById("list-body"));
	},1000)
  },
  methods:{
  	initData:function (){// 获取随叫随到订单数
  		var vm = this;
  		$.ajax({
             type: "GET",
             url: vm.http+"/miscellaneous/Driverdoubletwelve/getInitPage?driver_id="+vm.driver_id,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200){
	         		console.log(data)
	         		vm.isLogin = data.result.isLogin;
	          		if(vm.isLogin==0){
	           			vm.showMask=true;
	          		}
	         		vm.orderNums = data.result.count;
	         		vm.orderRemain = data.result.count_remain;
	         		vm.isClick = data.result.isClick;
	         		vm.luckyList = data.result.driverList;
	            }
              },
              error:function(e){
                //alert(JSON.stringify(e));
                alert("网路异常");
              }
        });
	},
	login:function(){//登录，传手机号和身份证后四位
  		var vm = this;
		if(!vm.telNum || !vm.idCard){
			vm.showToast = true;
     		vm.toastMsg="手机号或身份证不能为空";
     		setTimeout(function(){
     			vm.showToast = false;
     		},2000)
     		return
		}
		$.ajax({
             type: "GET",
             url: vm.http+"/miscellaneous/Driverdoubleeleven/login?cellphone="+vm.telNum+"&id_card="+vm.idCard,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200 &&data.result.status==1){
	         		vm.showMask=false;
	         		vm.driver_id = data.result.driver_id;
	         		vm.initData();//刷新页面
	            }else{//登录信息错误不可抽奖
	            	vm.showToast = true;
	         		vm.toastMsg=data.msg;
	         		setTimeout(function(){
	         			vm.showToast = false;
	         		},2000)
	            }
              },
              error:function(e){
                alert(JSON.stringify(e));
              }
        });
  	},
	getResult:function(){//点击抽奖
		if(this.isClick<=0){//不可以抽奖
			return
		}
		this.isClick = -1//已经点击过了
		var vm = this;
		$.ajax({
             type: "GET",
             url: vm.http+"/miscellaneous/Driverdoubletwelve/getResult?driver_id="+vm.driver_id,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200){//100%中奖
	         		vm.maskType=1;
	         		vm.winPrize=data.msg;
	         	}
	         	vm.showMask=true;
	         	vm.initData();//刷新页面
              },
              error:function(e){
                alert(JSON.stringify(e));
              }
        });
	},
	closeMask:function(){
		this.showMask=false;
	},
	toPrize:function(num){
		if(num===0){
			return "前10个订单";
		}else if(num==1){
			return "二十个订单免佣 ";
		}else if(num==2){
			return "一百个订单免佣";
		}else{
			return "五万元现金 ";
		}
	}
 }
})


</script>
	</body>
</html>
